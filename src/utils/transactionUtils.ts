import { log, line } from "#src/utils/logger.pino.js";

/**
 * Realiza un rollback seguro en una transacci贸n si sigue activa.
 * @param {object} transaction - Objeto de transacci贸n de Sequelize.
 * @returns {Promise<void>} Promesa que se resuelve cuando el rollback termina o si no es necesario.
 */
export const safeRollback = async (transaction) => {
  if (transaction && !transaction.finished) {
    try {
      await transaction.rollback();
      log.debug(line(), "Transacci贸n rollback exitosa");
    } catch (error) {
      log.error(line(), "Error al intentar rollback:", error);
      throw error; // Relanzar para que el consumidor pueda manejarlo si es necesario
    }
  } else {
    log.debug(line(), "No se requiere rollback: transacci贸n ya finalizada o no existe");
  }
};
